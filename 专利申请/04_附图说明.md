# 附图说明

## 一种基于多尺度Transformer的电池SOH和SOC联合预测方法及系统

本专利申请需要提供以下附图：

---

## 图1：整体架构流程图

**图示内容：**

```
┌─────────────────┐
│ 输入时间序列数据  │
│ [电流,电压,温度]  │
│  [batch,60,6]   │
└────────┬────────┘
         │
         ├──────────────┬──────────────┐
         ↓              ↓              ↓
   ┌──────────┐   ┌──────────┐   ┌──────────┐
   │Conv1d(k=3)│   │Conv1d(k=7)│   │Conv1d(k=15)│
   │短期特征   │   │中期特征   │   │长期特征    │
   └────┬─────┘   └────┬─────┘   └────┬──────┘
        ↓              ↓              ↓
   ┌──────────┐   ┌──────────┐   ┌───────────┐
   │Transformer│   │Transformer│   │Transformer│
   │Encoder-1  │   │Encoder-2  │   │Encoder-3  │
   └────┬─────┘   └────┬─────┘   └────┬──────┘
        │              │              │
        └──────┬───────┴──────┬───────┘
               ↓              ↓
        ┌────────────────────────┐
        │  跨尺度自适应注意力     │
        │  Cross-Scale Attention │
        │  • 全局池化            │
        │  • 权重计算            │
        │  • 加权融合            │
        └──────────┬─────────────┘
                   ↓
            ┌─────────────┐
            │  融合特征    │
            │ [batch, 64] │
            └──────┬──────┘
                   │
           ┌───────┴────────┐
           ↓                ↓
     ┌──────────┐     ┌──────────┐
     │SOC预测头  │     │SOH预测头  │
     └────┬─────┘     └────┬─────┘
          ↓                ↓
       [SOC]            [SOH]
      0-100%           0-100%
```

**图示说明：**
- 虚线框：模块边界
- 实线箭头：数据流向
- 标注数据维度：[batch, seq_len, features]

**绘图要求：**
- 使用专业制图工具（Visio, PowerPoint, 或专业绘图软件）
- 黑白图，线条清晰
- 字体统一，大小适中
- 箭头明确表示数据流向

---

## 图2：多尺度特征提取模块详细结构图

**图示内容：**

展示三个并行的特征提取分支，详细描述每个分支的结构：

**短期分支**：
```
输入 [batch,60,6]
  ↓ permute
[batch,6,60]
  ↓ Conv1d(in=6, out=64, kernel=3, padding=1)
[batch,64,60]
  ↓ permute
[batch,60,64]
  ↓ TransformerEncoderLayer(d_model=64, nhead=4)
[batch,60,64] → 短期编码特征
```

**中期分支**：
```
输入 [batch,60,6]
  ↓ permute
[batch,6,60]
  ↓ Conv1d(in=6, out=64, kernel=7, padding=3)
[batch,64,60]
  ↓ permute
[batch,60,64]
  ↓ TransformerEncoderLayer(d_model=64, nhead=4)
[batch,60,64] → 中期编码特征
```

**长期分支**：
```
输入 [batch,60,6]
  ↓ permute
[batch,6,60]
  ↓ Conv1d(in=6, out=64, kernel=15, padding=7)
[batch,64,60]
  ↓ permute
[batch,60,64]
  ↓ TransformerEncoderLayer(d_model=64, nhead=4)
[batch,60,64] → 长期编码特征
```

**标注说明：**
- kernel_size的物理意义：
  - k=3: 捕获~30秒的短期波动
  - k=7: 捕获~70秒的中期趋势
  - k=15: 捕获~150秒的长期模式

**绘图要点：**
- 三个分支并行排列
- 用不同颜色区分（打印时用不同阴影）
- 标注关键参数（kernel_size, d_model等）

---

## 图3：跨尺度自适应注意力融合机制详细图

**图示内容：**

```
短期特征[B,60,64]    中期特征[B,60,64]    长期特征[B,60,64]
      ↓                     ↓                     ↓
   GlobalAvgPool         GlobalAvgPool         GlobalAvgPool
      ↓                     ↓                     ↓
  [B,64]                [B,64]                [B,64]
      └──────────┬──────────┴──────────┐
                 ↓
            Concat [B,192]
                 ↓
          Linear(192→128)
                 ↓
              ReLU
                 ↓
          Linear(128→3)
                 ↓
             Softmax
                 ↓
     ┌───────[w1, w2, w3]───────┐
     │      权重 [B,3]           │
     ↓           ↓               ↓
  w1×短期     w2×中期        w3×长期
     ↓           ↓               ↓
  [B,60,64]   [B,60,64]      [B,60,64]
     │           │               │
     └──────┬────┴────┬──────────┘
            ↓         ↓
         Mean      Mean
            ↓
        Concat [B,192]
            ↓
     Linear(192→64)
            ↓
     融合特征 [B,64]
```

**重点标注：**
- 自适应权重 w1, w2, w3 的计算过程
- Softmax确保 w1+w2+w3=1
- 权重用于加权不同尺度特征

**图例说明：**
- B: batch size
- 数字: 特征维度

---

## 图4：双任务预测模块结构图

**图示内容：**

```
          融合特征 [B,64]
                 │
         ┌───────┴────────┐
         ↓                ↓
    SOC预测头         SOH预测头
         │                │
    Linear(64→32)    Linear(64→32)
         ↓                ↓
       ReLU             ReLU
         ↓                ↓
     Dropout(0.1)     Dropout(0.1)
         ↓                ↓
    Linear(32→1)     Linear(32→1)
         ↓                ↓
       [B,1]            [B,1]
         │                │
         └────────┬───────┘
                  ↓
           输出 [B,2]
          [SOC, SOH]
```

**标注说明：**
- 两个预测头结构相同但参数独立
- 共享融合特征
- Dropout用于防止过拟合

---

## 图5：不同电池状态下的多尺度权重分布图

**图示内容：**

### (a) 柱状图：不同SOH下的权重分布

```
权重
1.0│
   │     ┌─┐
0.8│     │ │               ┌─┐
   │     │ │         ┌─┐   │ │
0.6│     │□│         │ │   │□│
   │     │ │   ┌─┐   │□│   │ │
0.4│┌─┐  │ │   │ │   │ │   │ │  ┌─┐
   ││□│  │ │   │□│   │ │   │ │  │□│
0.2││ │  │ │   │ │   │ │   │ │  │ │
   ││ │  │ │   │ │   │ │   │ │  │ │
0.0└┴─┴──┴─┴───┴─┴───┴─┴───┴─┴──┴─┴──
   短中长 短中长  短中长  短中长 短中长
   SOH:   95%    80%     65%    50%

图例：■短期 □中期 ░长期
```

### (b) 折线图：权重随SOH变化趋势

```
权重
1.0│
   │                    ●●●●●●●
0.8│                  ●          长期权重
   │                ●
0.6│              ●
   │          ▲▲▲▲
0.4│      ▲▲▲▲        中期权重
   │  ■■■■
0.2│■■                短期权重
   │
0.0└──────────────────────────→
   100%  90%  80%  70%  60%  50%  SOH
```

**标注说明：**
- 健康电池（SOH>90%）：长期权重高（~0.60）
- 中度退化（70-90%）：三个尺度较均衡
- 重度退化（SOH<70%）：短期权重高（~0.45）

---

## 图6：实验对比结果图

### (a) 预测精度对比柱状图

```
MAE(%)
5.0│
   │
4.0│        ■
   │
3.0│        ■         ■
   │    ■   ■         ■   ■
2.0│    ■   ■   ■     ■   ■
   │    ■   ■   ■     ■   ■
1.0│    ■   ■   ■     ■   ■
   │    ■   ■   ■     ■   ■
0.0└────┴───┴───┴─────┴───┴───
     本发明 标准  轻量  本发明 标准 轻量
        SOC预测         SOH预测
```

### (b) 模型大小与推理时间对比

```
模型大小(MB)
4.0│    ■ 标准Transformer (3.6MB)
   │
3.0│
   │
2.0│
   │
1.0│              ■ 轻量级(0.4MB)
   │        ● 本发明(0.6MB)
0.0└────────────────────────────→
      5   7   10  15  20  推理时间(ms)
```

### (c) 预测散点图（SOC）

```
预测值(%)
100│        ●●●
   │      ●●●●●●
   │    ●●●●●●●●
   │  ●●●●●●●●●●
   │●●●●●●●●●●●●
   │●●●●●●●●●●
   │  ●●●●●●
   │    ●●
0  └──────────────────→
   0              100  真实值(%)

   虚线：y=x（理想预测）
   R² = 0.967
```

---

## 附图绘制建议

### 1. 使用工具
- **流程图**：Microsoft Visio, Draw.io, Lucidchart
- **结构图**：PowerPoint, Keynote
- **数据图**：Python (Matplotlib), Excel, Origin
- **专业制图**：Adobe Illustrator

### 2. 格式要求
- **尺寸**：A4纸大小（210mm × 297mm）
- **分辨率**：300 DPI以上
- **格式**：黑白图或灰度图
- **线条**：清晰，粗细适中（0.5-1.0 pt）
- **字体**：宋体或黑体，10-12号字
- **标注**：清晰完整，不遗漏关键信息

### 3. 绘图流程
1. 先用工具绘制草图
2. 确认布局和标注
3. 精细化绘制
4. 导出为高清图片
5. 检查清晰度和完整性

### 4. 命名规范
- 图1_整体架构流程图.png
- 图2_多尺度特征提取模块.png
- 图3_跨尺度注意力融合.png
- 图4_双任务预测模块.png
- 图5_多尺度权重分布.png
- 图6_实验对比结果.png

---

## 附图的作用

1. **流程图**（图1）：展示整体技术方案，审查员快速理解发明
2. **结构图**（图2-4）：详细说明各模块实现，支撑权利要求
3. **数据图**（图5-6）：展示技术效果，证明有益效果
4. **对比图**（图6）：突出本发明的优势，增强说服力

---

## 注意事项

1. **附图必须与说明书一致**：图中的标注、数字必须与说明书对应
2. **附图必须清晰**：审查员要能从附图中理解技术方案
3. **附图编号连续**：从图1开始，不能跳号
4. **附图标注规范**：使用数字标注，在说明书中解释
5. **避免使用彩色**：专利附图通常要求黑白或灰度

---

## 可选：使用Python生成数据图

如需生成图5和图6的数据图，可以运行：

```bash
python experiments.py  # 生成对比实验图
```

这将在 `results/` 目录下生成：
- `metrics_comparison.png` - 可用于图6(a)
- `predictions_scatter.png` - 可用于图6(c)
- `complexity_vs_performance.png` - 可用于图6(b)

然后根据专利附图要求进行格式调整。
